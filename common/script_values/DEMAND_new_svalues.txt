DEMAND_need_life_goods = {
	# Per pop
	value = 0.3
}

DEMAND_unfulfilled_food_need_governorship = {
	# Scope: governorship
	value = DEMAND_total_food_need_governorship
	subtract = DEMAND_fulfilled_food_need_governorship
}

DEMAND_total_food_need_governorship = {
	# Scope: governorship
	add = governorship_population
	multiply = DEMAND_need_life_goods
}

DEMAND_fulfilled_food_need_governorship = {
	# Scope = governorship
	# Non-food farming and hunting - provides quarter food
	add = GOODS_governorship_wool_produced
	add = GOODS_governorship_opium_produced
	add = GOODS_governorship_tobacco_produced
	add = GOODS_governorship_fur_produced
	add = GOODS_governorship_whales_produced
	add = GOODS_governorship_wood_produced
	add = GOODS_governorship_hardwood_produced
	add = GOODS_governorship_rubber_produced
	divide = 2

	# Cash crops - provide half food
	add = GOODS_governorship_chocolate_produced
	add = GOODS_governorship_spices_produced
	add = GOODS_governorship_tea_produced
	add = GOODS_governorship_sugar_produced
	add = GOODS_governorship_coffee_produced
	add = GOODS_governorship_cotton_produced
	divide = 2

	# Fully food goods
	add = GOODS_governorship_fish_produced
	add = GOODS_governorship_grain_produced
	add = GOODS_governorship_livestock_produced
	add = GOODS_governorship_mediterranean_fruit_produced
	add = GOODS_governorship_tropical_fruit_produced
	add = GOODS_governorship_temperate_fruit_produced
	add = GOODS_governorship_vegetables_produced
}

### FOOD
# Demand must factor in some form of elasticity - substitutions of different food types factor in here.
# Demand for each food tradegood is equal to:
# Get the % difference of the tradegood in question vs the average price of all food tradegoods, -1
# Demand = Unfulfilled food need /7 x (1- % difference in price)
# Divide by 7 for the 7 types of food good
# e.g. if wheat is 50% more expensive than the average food tradegood, the demand for wheat is:
# ( Unfulfilled food need / 7) x 0.5
# if vegetables are 25% cheaper than the average food tradegood, the demand of vegetables is:
# ( Unfulfilled food need / 7 )x 1.25

DEMAND_num_food_tradegoods = {
	# Records the number of food type tradegoods
	value = 7
}

## Food average price in the governorship

DEMAND_food_avg_price = {
	# SHOULD BE CACHED FOR PERFORMANCE
	# TODO
	value = var:price_grain
	add = var:price_fish
	add = var:price_livestock
	add = var:price_mediterranean_fruit
	add = var:price_tropical_fruit
	add = var:price_vegetables
	divide = DEMAND_num_food_tradegoods
}

## Individual food goods

DEMAND_actual_grain = {
	value = DEMAND_unfulfilled_food_need_governorship
	divide = DEMAND_num_food_tradegoods
	if = {
		limit = {
			has_global_variable = first_time_price_setup_done
		}
		divide = DEMAND_grain_price_diff_to_food_avg
	}
}

DEMAND_grain_price_diff_to_food_avg = {
	# Scope: governorship
	# Function: get the % difference of the price of the given tradegood to the average food goods price
	# This is used to modify demand, more expensive foods will be shunned in favour of cheaper ones
	value = var:price_grain
	divide = DEMAND_food_avg_price
}