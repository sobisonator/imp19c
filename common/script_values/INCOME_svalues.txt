## Script values used in the calculation of government income

# National summary

INCOME_national_total_quarterly = {
	# Scope: Country
	# This should be cached quarterly to minimise hot-loading it all the time as it is always visible in the ingame topbar
	value = INCOME_national_total_from_regions
	add = INCOME_national_total_from_subjects
	# Negative
	add = INCOME_cost_administrator_wages_country
	add = INCOME_cost_military_wages_country
	add = INCOME_cost_military_supplies_country
	add = INCOME_cost_navy_supplies_country
	add = CURRENCY_national_debt_interest_actual_wealth_cost
	add = INCOME_cost_poor_law_spending
}

INCOME_national_total_from_regions = {
	# Scope: Country
	value = 0
	every_governorships = {
		add = INCOME_governorship_total
	}
}

INCOME_national_total_from_tax = {
	# Scope: Country
	value = 0
	every_governorships = {
		add = INCOME_governorship_tax
	}
}

INCOME_national_total_production = {
	# Scope: Country
	value = 0
	every_governorships = {
		add = INCOME_governorship_production
	}
}

INCOME_national_total_from_tariffs_and_shipping = {
	# Scope: Country
	value = 0
	every_governorships = {
		add = INCOME_governorship_tariffs_and_shipping
	}
}

INCOME_national_total_from_subjects = {
	# Scope: Country
	value = 0
	if = {
		limit = {
			is_subject = no
		}
		every_subject = {
			add = INCOME_subject_overlord_duty
		}
	}
	else = {
		subtract = INCOME_subject_overlord_duty
		every_subject = {
			add = INCOME_subject_overlord_duty
		}
	}
}

# Outgoings

INCOME_cost_administrator_wages_country = {
	value = 0
	if = {
		limit = {
			has_variable = official_currency
		}
		every_governorships = {
			if = {
				limit = {
					has_variable = WEALTH_wages_due_administrators
				}
				add = var:WEALTH_wages_due_administrators
			}
			# TODO: Paid by the Upper Strata or Governor characters if Feudal
		}
		multiply = -1
	}
}

INCOME_cost_military_wages_country = {
	value = 0
	if = {
		limit = {
			has_variable = official_currency
		}
		every_governorships = {
			if = {
				limit = {
					has_variable = WEALTH_wages_due_military
				}
				add = var:WEALTH_wages_due_military
			}
			# TODO: Paid by the Upper Strata or Governor characters if Feudal
		}
		multiply = -1
	}
}

INCOME_cost_military_supplies_country = {
	value = 0
	every_governorships = {
		add = {
			value = DEMAND_early_munitions
			multiply = owner.var:country_unit_price_early_munitions
		}
		add = {
			value = DEMAND_early_artillery
			multiply = owner.var:country_unit_price_early_artillery
		}
		# TODO: consider late variants
		add = {
			value = DEMAND_clothing_from_military
			multiply = owner.var:country_unit_price_clothing
		}
		add = {
			value = DEMAND_pharmaceuticals_from_military
			multiply = owner.var:country_unit_price_pharmaceuticals
		}
		add = {
			value = DEMAND_construction_materials_military
			multiply = owner.var:country_unit_price_construction_materials
		}
	}
	multiply = -1
	# TODO: Pay this into a pool which is paid out to the population to reimburse for trade or locally purchased goods
}

INCOME_cost_navy_supplies_country = {
	value = 0
	every_governorships = {
		add = {
			value = DEMAND_wooden_ships_navy
			multiply = owner.var:country_unit_price_wooden_ships
		}
		add = {
			value = DEMAND_naval_supplies_navy
			multiply = owner.var:country_unit_price_naval_supplies
		}
		# TODO: Account for steel ships
	}
	multiply = -1
	# TODO: Pay this into a pool which is paid out to the population to reimburse for trade or locally purchased goods
}

# End national summary

###

# Subject-overlord duty
# This is a tax paid on the national income of a country to the overlord.

INCOME_subject_overlord_duty_rate = {
	value = 0.2 # TODO: Make this based on a variable stored in the Country scope
}

INCOME_subject_overlord_duty = {
	value = INCOME_national_total_from_regions
	min = 0
	# Depends on the subject-overlord contract
	multiply = INCOME_subject_overlord_duty_rate
}

###

INCOME_governorship_tax = {
	# Scope: Governorship
	# Function: Get all the tax income from a governorship
	value = INCOME_governorship_property_tax_total_positive
	add = INCOME_governorship_excise_duty_essentials_total_positive
	add = INCOME_governorship_income_tax_total_positive
}

INCOME_governorship_tariffs_and_shipping = {
	# Scope: Governorship
	# Get all tariff and shipping income from a governorship
	value = INCOME_governorship_tariffs_total_positive
	add = INCOME_governorship_state_port_charges
}

INCOME_governorship_production = {
	# Scope: Governorship
	# Get all government production income from a governorship
	value = INCOME_governorship_state_resource_extraction
	add = INCOME_governorship_state_manufacturing
}

INCOME_governorship_total = {
	# Scope: Governorship
	# Function: Get the total amount of government income in a governorship
	value = INCOME_governorship_excise_duty_essentials_total_positive
	# add = INCOME_governorship_excise_duty_luxuries
	add = INCOME_governorship_property_tax_total_positive
	add = INCOME_governorship_income_tax_total_positive
	add = INCOME_governorship_tariffs_total_positive
	add = INCOME_governorship_state_port_charges
	add = INCOME_governorship_state_resource_extraction
	add = INCOME_governorship_state_manufacturing
}

### TAXATION & TARIFFS
# A currency is required in order to tax. Any levies or tithes made in kind are represented under the TITHES heading

## EXCISE DUTY - ESSENTIALS
# Consumption tax on cost of living, paid by pops according to their cost of living expenses
# Calculated as a percentage of the cost of living for each pop

INCOME_excise_duties_country = {
	# Scope: Country
	value = 0
	every_governorships = {
		add = INCOME_governorship_excise_duty_essentials_total_positive
	}
}

INCOME_governorship_excise_duty_essentials_total_positive = {
	value = INCOME_governorship_excise_duty_essentials_upper_strata
	add = INCOME_governorship_excise_duty_essentials_middle_strata
	add = INCOME_governorship_excise_duty_essentials_lower_strata
	add = INCOME_governorship_excise_duty_essentials_proletariat
	multiply = -1
}

# TODO: Combine this with excise duty on luxuries!
INCOME_governorship_excise_duty_essentials_upper_strata = {
	if = {
		limit = {
			owner = {
				has_variable = INCOME_taxrate_excise_duty_essentials
			}
		}
		value = WEALTH_cost_of_living_upper_strata
		multiply = owner.var:INCOME_taxrate_excise_duty_essentials
	}
	else = {
		value = 0
	}		
}
INCOME_governorship_excise_duty_essentials_middle_strata = {
	if = {
		limit = {
			owner = {
				has_variable = INCOME_taxrate_excise_duty_essentials
			}
		}
		value = WEALTH_cost_of_living_middle_strata
		multiply = owner.var:INCOME_taxrate_excise_duty_essentials
	}
	else = {
		value = 0
	}		
}
INCOME_governorship_excise_duty_essentials_lower_strata = {
	if = {
		limit = {
			owner = {
				has_variable = INCOME_taxrate_excise_duty_essentials
			}
		}
		value = WEALTH_cost_of_living_lower_strata
		multiply = owner.var:INCOME_taxrate_excise_duty_essentials
	}	
	else = {
		value = 0
	}		
}
INCOME_governorship_excise_duty_essentials_proletariat = {
	if = {
		limit = {
			owner = {
				has_variable = INCOME_taxrate_excise_duty_essentials
			}
		}
		value = WEALTH_cost_of_living_proletariat
		multiply = owner.var:INCOME_taxrate_excise_duty_essentials
	}
	else = {
		value = 0
	}	
}

## EXCISE DUTY - LUXURIES
### NOT CURRENTLY ENABLED

INCOME_governorship_excise_duty_luxuries = {
	# Consumption tax on luxuries, paid by pops according to trade share
	# Calculated as a percentage of the total wealth paid for luxuries in the governorship
	if = {
		limit = {
			owner = {
				has_variable = INCOME_taxrate_excise_duty_luxuries
			}
		}
		if = {
			limit = {
				has_variable = final_quarterly_wealth_owed_for_tobacco
			}
			value = var:final_quarterly_wealth_owed_for_tobacco
		}
		if = {
			limit = {
				has_variable = final_quarterly_wealth_owed_for_sugar
			}
			add = var:final_quarterly_wealth_owed_for_sugar
		}
		if = {
			limit = {
				has_variable = final_quarterly_wealth_owed_for_opium
			}
			add = var:final_quarterly_wealth_owed_for_opium
		}
		if = {
			limit = {
				has_variable = final_quarterly_wealth_owed_for_alcohol
			}
			add = var:final_quarterly_wealth_owed_for_alcohol
		}
		if = {
			limit = {
				has_variable = final_quarterly_wealth_owed_for_luxury_clothing
			}
			add = var:final_quarterly_wealth_owed_for_luxury_clothing
		}
		if = {
			limit = {
				has_variable = final_quarterly_wealth_owed_for_luxury_furniture
			}
			add = var:final_quarterly_wealth_owed_for_luxury_furniture
		}
		if = {
			limit = {
				has_variable = final_quarterly_wealth_owed_for_gems
			}
			add = var:final_quarterly_wealth_owed_for_gems
		}
		if = {
			limit = {
				has_variable = final_quarterly_wealth_owed_for_coffee
			}
			add = var:final_quarterly_wealth_owed_for_coffee
		}
		if = {
			limit = {
				has_variable = final_quarterly_wealth_owed_for_spices
			}
			add = var:final_quarterly_wealth_owed_for_spices
		}
		if = {
			limit = {
				has_variable = final_quarterly_wealth_owed_for_sugar
			}
			add = var:final_quarterly_wealth_owed_for_sugar
		}
		multiply = owner.var:INCOME_taxrate_excise_duty_luxuries
	}
	else = {
		value = 0
	}
}

## PROPERTY TAX

INCOME_property_tax_country = {
	value = 0
	every_governorships = {
		add = INCOME_governorship_property_tax_total_positive
	}
}

INCOME_governorship_property_tax_total_positive = {
	value = INCOME_governorship_property_tax
	multiply = -1
}

INCOME_governorship_property_tax = {
	# Tax paid by pops based on number of housing districts
	# Pops pay tax based on the breakdown of land ownership in the governorship
	# TODO: Create a land ownership breakdown
	if = {
		limit = {
			owner = {
				has_variable = INCOME_taxrate_property_tax
			}
		}
		value = {
			value = governorship_num_of_URB_residential_district
			multiply = 5
		}
		add = {
			every_governorship_state = {
				every_state_province = {
					add = population_cap
				}
			}
			min = 1
			divide = 50
		}
		multiply = -1 # TODO: Make this sensitive to property prices, perhaps a property demand value
		multiply = owner.var:INCOME_taxrate_property_tax
	}
	else = {
		value = 0
	}
}

INCOME_governorship_property_tax_upper_strata = {
	value = INCOME_governorship_property_tax
	multiply = WEALTH_governorship_property_ownership_share_upper_strata
}
INCOME_governorship_property_tax_middle_strata = {
	value = INCOME_governorship_property_tax
	multiply = WEALTH_governorship_property_ownership_share_middle_strata
}
INCOME_governorship_property_tax_lower_strata = {
	value = INCOME_governorship_property_tax
	multiply = WEALTH_governorship_property_ownership_share_lower_strata
}
INCOME_governorship_property_tax_proletariat = {
	value = 0
}

## INCOME TAX

INCOME_income_tax_country = {
	value = 0
	every_governorships = {
		add = INCOME_governorship_income_tax_total_positive
	}
}

INCOME_governorship_income_tax_total_positive = {
	value = INCOME_governorship_income_tax_proletariat
	add = INCOME_governorship_income_tax_lower_strata
	add = INCOME_governorship_income_tax_middle_strata
	add = INCOME_governorship_income_tax_upper_strata
	multiply = -1
}

INCOME_governorship_income_tax_proletariat = {
	# Tax paid by pops as a percentage of wealth they earn NOT from trade in a quarter
	if = {
		limit = {
			owner = {
				has_variable = INCOME_taxrate_income_tax
			}
		}
		value = JOBS_wages_due_proletariat
		if = {
			limit = {
				has_variable = this_income_from_shipping_proletariat
			}
			add = var:this_income_from_shipping_proletariat
		}
		if = {
			limit = {
				has_variable = this_income_from_manufacturing_proletariat
			}
			add = var:this_income_from_manufacturing_proletariat
		}
		if = {
			limit = {
				has_variable = this_income_from_resource_extraction_proletariat
			}
			add = var:this_income_from_resource_extraction_proletariat
		}
		if = {
			limit = {
				has_variable = WEALTH_new_generated_services_proletariat
			}
			add = var:WEALTH_new_generated_services_proletariat
		}
		multiply = owner.var:INCOME_taxrate_income_tax
		multiply = -1
	}
	else = {
		value = 0
	}
}

INCOME_governorship_income_tax_lower_strata = {
	# Tax paid by pops as a percentage of wealth they earn NOT from trade in a quarter
	if = {
		limit = {
			owner = {
				has_variable = INCOME_taxrate_income_tax
			}
		}
		if = {
			limit = {
				has_variable = this_income_from_shipping_lower_strata
			}
			value = var:this_income_from_shipping_lower_strata
		}
		if = {
			limit = {
				has_variable = this_income_from_manufacturing_lower_strata
			}
			add = var:this_income_from_manufacturing_lower_strata
		}
		if = {
			limit = {
				has_variable = this_income_from_resource_extraction_lower_strata
			}
			add = var:this_income_from_resource_extraction_lower_strata
		}
		if = {
			limit = {
				has_variable = WEALTH_new_generated_services_lower_strata
			}
			add = var:WEALTH_new_generated_services_lower_strata
		}
		multiply = owner.var:INCOME_taxrate_income_tax
		multiply = -1
	}
	else = {
		value = 0
	}
}

INCOME_governorship_income_tax_middle_strata = {
	# Tax paid by pops as a percentage of wealth they earn NOT from trade in a quarter
	if = {
		limit = {
			owner = {
				has_variable = INCOME_taxrate_income_tax
			}
		}
		value = JOBS_wages_due_middle_strata
		if = {
			limit = {
				has_variable = this_income_from_shipping_middle_strata
			}
			add = var:this_income_from_shipping_middle_strata
		}
		if = {
			limit = {
				has_variable = this_income_from_manufacturing_middle_strata
			}
			add = var:this_income_from_manufacturing_middle_strata
		}
		if = {
			limit = {
				has_variable = this_income_from_resource_extraction_middle_strata
			}
			add = var:this_income_from_resource_extraction_middle_strata
		}
		if = {
			limit = {
				has_variable = WEALTH_new_generated_services_middle_strata
			}
			add = var:WEALTH_new_generated_services_middle_strata
		}
		multiply = owner.var:INCOME_taxrate_income_tax
		multiply = -1

		if = {
			limit = {
				owner = {
					has_variable = INCOME_progressive_income_tax_enabled
				}
			}
			multiply = 1.5
		}
	}
	else = {
		value = 0
	}
}

INCOME_governorship_income_tax_upper_strata = {
	# Tax paid by pops as a percentage of wealth they earn NOT from trade in a quarter
	if = {
		limit = {
			owner = {
				has_variable = INCOME_taxrate_income_tax
			}
		}
		value = JOBS_wages_due_upper_strata
		if = {
			limit = {
				has_variable = this_income_from_shipping_upper_strata
			}
			add = var:this_income_from_shipping_upper_strata
		}
		if = {
			limit = {
				has_variable = this_income_from_manufacturing_upper_strata
			}
			add = var:this_income_from_manufacturing_upper_strata
		}
		if = {
			limit = {
				has_variable = this_income_from_resource_extraction_upper_strata
			}
			add = var:this_income_from_resource_extraction_upper_strata
		}
		if = {
			limit = {
				has_variable = WEALTH_new_generated_services_upper_strata
			}
			add = var:WEALTH_new_generated_services_upper_strata
		}
		multiply = owner.var:INCOME_taxrate_income_tax
		multiply = -1

		if = {
			limit = {
				owner = {
					has_variable = INCOME_progressive_income_tax_enabled
				}
			}
			multiply = 2.5
		}
	}
	else = {
		value = 0
	}
}


## TARIFFS

INCOME_tariffs_country = {
	value = 0
	every_governorships = {
		add = INCOME_governorship_tariffs_total_positive
	}
}

INCOME_governorship_tariffs_total_positive = {
	value = INCOME_governorship_tariffs_upper_strata
	add = INCOME_governorship_tariffs_middle_strata
	add = INCOME_governorship_tariffs_lower_strata
	add = INCOME_governorship_tariffs_proletariat
	add = INCOME_governorship_tariffs_tribesmen
	multiply = -1
}

INCOME_governorship_tariffs_upper_strata = {
	# Tax by traders as a percentage of the total cost of importing goods
	# TODO: Tariffs should provide special bonuses/maluses to the state:
	## Higher tarrifs should:
	## ---% trade penetration from trade agreements
	## +++% trade penetration from own provinces and colonies
	if = {
		limit = {
			owner = {
				has_variable = INCOME_taxrate_tariffs
			}
		}
		if = {
			limit = {
				has_variable = this_expenses_from_resource_extraction_upper_strata
			}
			value = var:this_expenses_from_resource_extraction_upper_strata
		}
		if = {
			limit = {
				has_variable = this_expenses_from_manufacturing_upper_strata
			}
			add = var:this_expenses_from_manufacturing_upper_strata
		}
		multiply = owner.var:INCOME_taxrate_tariffs
	}
	else = {
		value = 0
	}
}

INCOME_governorship_tariffs_middle_strata = {
	# Tax by traders as a percentage of the total cost of importing goods
	if = {
		limit = {
			owner = {
				has_variable = INCOME_taxrate_tariffs
			}
		}
		if = {
			limit = {
				has_variable = this_expenses_from_resource_extraction_middle_strata
			}
			value = var:this_expenses_from_resource_extraction_middle_strata
		}
		if = {
			limit = {
				has_variable = this_expenses_from_manufacturing_middle_strata
			}
			add = var:this_expenses_from_manufacturing_middle_strata
		}
		multiply = owner.var:INCOME_taxrate_tariffs
	}
	else = {
		value = 0
	}
}

INCOME_governorship_tariffs_lower_strata = {
	# Tax by traders as a percentage of the total cost of importing goods
	if = {
		limit = {
			owner = {
				has_variable = INCOME_taxrate_tariffs
			}
		}
		if = {
			limit = {
				has_variable = this_expenses_from_resource_extraction_lower_strata
			}
			value = var:this_expenses_from_resource_extraction_lower_strata
		}
		if = {
			limit = {
				has_variable = this_expenses_from_manufacturing_lower_strata
			}
			add = var:this_expenses_from_manufacturing_lower_strata
		}
		multiply = owner.var:INCOME_taxrate_tariffs
	}
	else = {
		value = 0
	}
}

INCOME_governorship_tariffs_proletariat = {
	# Tax by traders as a percentage of the total cost of importing goods
	if = {
		limit = {
			owner = {
				has_variable = INCOME_taxrate_tariffs
			}
		}
		if = {
			limit = {
				has_variable = this_expenses_from_resource_extraction_proletariat
			}
			value = var:this_expenses_from_resource_extraction_proletariat
		}
		if = {
			limit = {
				has_variable = this_expenses_from_manufacturing_proletariat
			}
			add = var:this_expenses_from_manufacturing_proletariat
		}
		multiply = owner.var:INCOME_taxrate_tariffs
	}
	else = {
		value = 0
	}
}

INCOME_governorship_tariffs_tribesmen = {
	# Tax by traders as a percentage of the total cost of importing goods
	if = {
		limit = {
			owner = {
				has_variable = INCOME_taxrate_tariffs
			}
		}
		if = {
			limit = {
				has_variable = this_expenses_from_resource_extraction_tribesmen
			}
			value = var:this_expenses_from_resource_extraction_tribesmen
		}
		if = {
			limit = {
				has_variable = this_expenses_from_manufacturing_tribesmen
			}
			add = var:this_expenses_from_manufacturing_tribesmen
		}
		multiply = owner.var:INCOME_taxrate_tariffs
	}
	else = {
		value = 0
	}
}

### DIRECT INCOME FROM STATE OWNERSHIP OF BUSINESS
## PORT CHARGES

INCOME_governorship_state_port_charges = {
	# This is calculated as the state's share in shipping income in a province, instead of as a tax out of the pops' governorship shipping income
	if = {
		limit = {
			has_variable = this_income_from_shipping_the_state
		}
		value = var:this_income_from_shipping_the_state
	}
	if = {
		limit = {
			has_variable = this_expenses_from_shipping_the_state
		}
		add = var:this_expenses_from_shipping_the_state
	}
}
INCOME_governorship_state_resource_extraction = {
	# This is calculated as the state's share in shipping income in a province, instead of as a tax out of the pops' governorship resource extraction income
	if = {
		limit = {
			has_variable = this_income_from_resource_extraction_the_state
		}
		value = var:this_income_from_resource_extraction_the_state
	}
	if = {
		limit = {
			has_variable = this_expenses_from_resource_extraction_the_state
		}
		add = var:this_expenses_from_resource_extraction_the_state
	}
}
INCOME_governorship_state_manufacturing = {
	# This is calculated as the state's share in shipping income in a province, instead of as a tax out of the pops' governorship resource extraction income
	if = {
		limit = {
			has_variable = this_income_from_manufacturing_the_state
		}
		value = var:this_income_from_manufacturing_the_state
	}
	if = {
		limit = {
			has_variable = this_expenses_from_manufacturing_the_state
		}
		add = var:this_expenses_from_manufacturing_the_state
	}
}

### PAYMENTS DUE TO POPS

INCOME_military_supplies_demand_governorship = {
	# Scope: Governorship
	# Function: Get total base demand for military supplies in this governorship
	value = DEMAND_clothing_from_military_base
	add = DEMAND_pharmaceuticals_from_military_base
	add = DEMAND_construction_materials_military_base
	add = DEMAND_early_munitions_base
	add = DEMAND_late_munitions_base
	add = DEMAND_early_artillery_base
	add = DEMAND_late_artillery_base
}

# TODO: Move into MILITARY svalues file

MILITARY_supplies_country_consumed_quarterly = {
	# Scope: Country
	# Function: Get the amount of supplies consumed out of the country stockpile every quarter by the military
	value = 0
	every_governorships = {
		add = DEMAND_early_munitions_base
		add = DEMAND_late_munitions_base
		add = DEMAND_clothing_from_military_base
		add = DEMAND_pharmaceuticals_from_military_base
		add = DEMAND_construction_materials_military_base
		add = DEMAND_early_artillery_base
		add = DEMAND_late_artillery_base
	}
	multiply = {
		value = -1
	}
}

MILITARY_supplies_income_country = {
	# Scope: Country
	# Function: Get the income of military supplies based on the fulfilled base demand
	value = 0
	every_governorships = {
		add = {
			value = DEMAND_early_munitions
			if = {
				limit = {
					has_variable = shortage_early_munitions
				}
				multiply = {
					value = 1 
					if = {
						limit = {
							has_variable = shortage_early_munitions
						}
						subtract = var:shortage_early_munitions
					}
				}
			}
		}
		add = {
			value = DEMAND_late_munitions
			if = {
				limit = {
					has_variable = shortage_late_munitions
				}
				multiply = {
					value = 1 
					if = {
						limit = {
							has_variable = shortage_early_munitions
						}
						subtract = var:shortage_early_munitions
					}
				}
			}
		}
		add = {
			value = DEMAND_clothing_from_military
			if = {
				limit = {
					has_variable = shortage_clothing
				}
				multiply = {
					value = 1 
					if = {
						limit = {
							has_variable = shortage_clothing
						}
						subtract = var:shortage_clothing
					}
				}
			}
		}
		add = {
			value = DEMAND_pharmaceuticals_from_military
			if = {
				limit = {
					has_variable = shortage_pharmaceuticals
				}
				multiply = {
					value = 1 
					if = {
						limit = {
							has_variable = shortage_pharmaceuticals
						}
						subtract = var:shortage_pharmaceuticals
					}
				}
			}
		}
		add = {
			value = DEMAND_construction_materials_military
			if = {
				limit = {
					has_variable = shortage_construction_materials
				}
				multiply = {
					value = 1 
					if = {
						limit = {
							has_variable = shortage_construction_materials
						}
						subtract = var:shortage_construction_materials
					}
				}
			}
		}						
	}
	if = {
		limit = {
			has_variable = INCOME_military_supplies_spending_rate
		}
		if = {
			limit = {
				var:INCOME_military_supplies_spending_rate > 1
			}
			if = {
				limit = {
					has_variable = INCOME_military_supplies_spending_rate
				}
				multiply = var:INCOME_military_supplies_spending_rate
			}
		}
	}
}

MILITARY_supplies_balance_country = {
	# Scope: Country
	value = MILITARY_supplies_income_country
	add = MILITARY_supplies_country_consumed_quarterly # Negative
}

# State subsidies and social welfare

# Notes: Poor law spending was about 2.5% annually of the UK's national GDP in 1815
# Starting wealth is 25,077. Multiplied by 0.025 then divided by 4 gives a quarterly expected national spend of about £157

INCOME_governorship_poor_law_spending = {
	# Scope: Governorship

	# Recipients are lower strata and proletariat

	# This value is only calculated if the country has a poor law active
	# TODO

	# A proportion of the pops' quarterly income minus outgoings is granted based on social welfare funding

	value = WEALTH_expenses_total_lower_strata
	add = WEALTH_income_total_lower_strata # negative value is subtracted on add
	add = WEALTH_expenses_total_proletariat
	add = WEALTH_income_total_proletariat
	# TODO: Create a WEALTH_income_total_POPTYPE for lower_strata and proletariat which includes welfare income so it can be used in the tooltips and wealth change effects!
	
	# TODO: Add a row for welfare in the governorship poptype wealth tooltips
	# TODO: Add public welfare to the national income tooltip
	

	# 100% of the pops' quarterly cost of living is distributed
	add = {
		value = WEALTH_cost_of_living_lower_strata
		add = WEALTH_cost_of_living_proletariat
	}

	max = 0

	# TODO:
	multiply = owner.var:INCOME_public_welfare_spending_rate
	multiply = -1

}

INCOME_cost_public_welfare = {
	value = INCOME_cost_poor_law_spending
	# TODO: Add others, e.g. public healthcare, subsidies
}

INCOME_cost_poor_law_spending = {
	value = 0
	every_governorships = {
		if = {
			limit = {
				owner = { has_law = local_poor_laws }
			}
			add = INCOME_governorship_poor_law_spending
		}
	}
	multiply = -1
}

INCOME_negative_8q_ago = {
	value = 50
}