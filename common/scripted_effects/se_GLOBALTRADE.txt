GT_do_global_trade = {
	SHIPPING_update_TZ_overview_piecharts = yes
	GT_update_governorship_vars = yes
	GT_cache_TZ_penetration_values = yes
	GT_reset_all_TZ_stockpiles = yes
}

GT_create_tradegroups = {
	# Scope: Random country, to every trade center province
	# Function: Create temporary objects that are used as proxies for groups of governorships within countries 
}

GT_update_governorship_vars = {
	# Scope: Random country
	# Function: Set the trade center variable in every governorship
	every_country = {
		every_governorships = {
				TRADE_governorship_get_pops_this_quarter = yes
				TRADE_set_internal_trade_scope = yes
				TRADE_update_governorship_TZs = yes
		}
	}
}

GT_reset_all_TZ_stockpiles = {
	every_trade_center = {
		every_tradegood_complex = {
			APPLY = GT_set_tradegood_TZ_stockpile_0
		}
	}
}

GT_set_tradegood_TZ_stockpile_0 = {
	set_variable = {
		name = TZ_stockpile_$tradegood$
		value = 0
	}
}

GT_declare_sell_to_TZ_aggregate_stockpile = {
	# Scope: Random country
	# Function: Every governorship declares its stockpile surplus of every tradegood as available to sell to its local tradezone, and some of it to the "global" tradezone
	every_country = {
		every_governorships = {

			save_scope_as = seller_governorship

			every_tradegood_complex = {
				APPLY = GT_declare_sell_amount
			}
			var:trade_center = {
				every_tradegood_complex = {
					APPLY = GT_update_TZ_sell_amount
				}
			}

		}
	}
}

GT_declare_sell_amount = {
	# Scope: Governorship
	if = {
		limit = {
			var:$tradegood$_stockpile > DEMAND_$tradegood$
		}
		set_variable = {
			name = for_sale_$tradegood$
			value = $tradegood$_stockpile
		}
		change_variable = {
			name = for_sale_$tradegood$
			subtract = $tradegood$_stockpile
		}
		set_variable = {
			name = for_sale_local_$tradegood$
			value = var:for_sale_$tradegood$
		}
		change_variable = {
			name = for_sale_local_$tradegood$
			multiply = 0.9 # TODO: Use a svalue that represents the percentage to be offered to the global TZ
		}
		set_variable = {
			name = for_sale_global_$tradegood$
			multiply = 0.1 # TODO: Use a svalue that represents the percentage to be offered to the global TZ
		}
	}
}

GT_update_TZ_sell_amount = {
	# Scope: trade center province
	change_variable = {
		name = TZ_stockpile_$tradegood$
		add = scope:seller_governorship.var:for_sale_local_$tradegood$
	}
	change_global_variable = {
		name = global_TZ_stockpile_$tradegood$
		add = scope:seller_governorship.var:for_sale_global_$tradegood$
	}
}

GT_cache_TZ_penetration_values = {
	every_country = {
		set_variable = {
			name = TZ_penetration_india
			value = TZ_penetration_india
		}
		set_variable = {
			name = TZ_penetration_east_north_america
			value = TZ_penetration_east_north_america
		}
		set_variable = {
			name = TZ_penetration_west_north_america
			value = TZ_penetration_west_north_america
		}
		set_variable = {
			name = TZ_penetration_caribbean
			value = TZ_penetration_caribbean
		}
		set_variable = {
			name = TZ_penetration_west_south_america
			value = TZ_penetration_west_south_america
		}
		set_variable = {
			name = TZ_penetration_east_south_america
			value = TZ_penetration_east_south_america
		}
		set_variable = {
			name = TZ_penetration_south_east_asia
			value = TZ_penetration_south_east_asia
		}
		set_variable = {
			name = TZ_penetration_indo_china
			value = TZ_penetration_indo_china
		}
		set_variable = {
			name = TZ_penetration_yellow_sea
			value = TZ_penetration_yellow_sea
		}
		set_variable = {
			name = TZ_penetration_southern_africa
			value = TZ_penetration_southern_africa
		}
		set_variable = {
			name = TZ_penetration_west_africa
			value = TZ_penetration_west_africa
		}
		set_variable = {
			name = TZ_penetration_east_africa
			value = TZ_penetration_east_africa
		}
		set_variable = {
			name = TZ_penetration_middle_east
			value = TZ_penetration_middle_east
		}
		set_variable = {
			name = TZ_penetration_western_steppe
			value = TZ_penetration_western_steppe
		}
		set_variable = {
			name = TZ_penetration_eastern_steppe
			value = TZ_penetration_eastern_steppe
		}
		set_variable = {
			name = TZ_penetration_upper_yangtzi
			value = TZ_penetration_upper_yangtzi
		}
		set_variable = {
			name = TZ_penetration_atlantic_seaboard
			value = TZ_penetration_atlantic_seaboard
		}
		set_variable = {
			name = TZ_penetration_central_europe
			value = TZ_penetration_central_europe
		}
		set_variable = {
			name = TZ_penetration_west_mediterranean
			value = TZ_penetration_west_mediterranean
		}
		set_variable = {
			name = TZ_penetration_baltic
			value = TZ_penetration_baltic
		}
		set_variable = {
			name = TZ_penetration_east_europe
			value = TZ_penetration_east_europe
		}
		set_variable = {
			name = TZ_penetration_east_mediterranean
			value = TZ_penetration_east_mediterranean
		}
	}
}