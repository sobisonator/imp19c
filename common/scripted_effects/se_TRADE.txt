TRADE_setup_list_of_tradegoods = {
	# Function: Create a list of random provinces with variables corresponding to all the tradegoods, so that you can iterate through the tradegoods
	# Scope: Random country
	# Called: At start of game
	random_province = {
		limit = {
			NOT = { has_variable = grain }
		}
		set_variable = {
			name = grain
		}
		add_to_global_variable_list = {
			name = list_of_tradegoods
			target = THIS
		}
	}
	random_province = {
		limit = {
			NOT = { has_variable = wood }
		}
		set_variable = {
			name = wood
		}
		add_to_global_variable_list = {
			name = list_of_tradegoods
			target = THIS
		}
	}
}

TRADE_setup_list_of_tradegoods_2 = {
	# Function: Create a list of random provinces with variables corresponding to all the tradegoods, so that you can iterate through the tradegoods
	# Version 2, save it into a variable with a consistent name but different value
	# Scope: Random country
	# Called: At start of game
	random_province = {
		limit = {
			NOT = { has_variable = tradegood }
		}
		set_variable = {
			name = tradegood
			value = grain
		}
		add_to_global_variable_list = {
			name = list_of_tradegoods
			target = THIS
		}
	}
	random_province = {
		limit = {
			NOT = { has_variable = wood }
		}
		set_variable = {
			name = tradegood
			value = wood
		}
		add_to_global_variable_list = {
			name = list_of_tradegoods
			target = THIS
		}
	}
}

TRADE_test_tradegoods_list = {
	# Scope: country
	every_in_global_list = {
		variable = list_of_tradegoods
		save_scope_as = this_tradegood
		switch = {

			trigger = has_variable
			grain = {
				prev = {
					TRADE_test_create_variable = {
						tradegood = grain
					}
				}
			}
			wood = {
				prev = {
					TRADE_test_create_variable = {
						tradegood = wood
					}
				}
			}

		}
	}
}

TRADE_test_create_variable = {
	remove_variable = test_variable_grain
	set_variable = {
		name = test_variable_$tradegood$
		value = 999
	}
	if = {
		limit = {
			has_variable = test_variable_grain
		}
		add_treasury = 50
	}
}

tradezone_setup_effect = {
	#Makes the most populated province in a trade zone a center of trade.
	#REQUIRED INPUT: TRADE_ZONE = XXX (scripted trigger name)
	random_region = {
		limit = {
			$TRADE_ZONE$ = {
				PROVINCE = no
			}
		}
		ordered_region_province = {
			order_by = total_population
			add_permanent_province_modifier = {
				name = regional_center_of_trade_level_1
			}
			add_to_global_variable_list = {
				name = list_of_trade_centers
				target = THIS
			}
			set_variable = $TRADE_ZONE$ # Record the name of the TZ in the province
		}
	}
}

# Function:	Add a variable to every governorship that stores the tradezone scope, so that you can easily scope to the TZ from a governorship with minimal performance overhead whenever necessary. This front-loads the performance overhead to the start of the game and any update periods.
# Scope:	Governorship
# Called:	1) Whenever the governorship change effects are called (e.g. change of territory)
#			2) At the beginning of the game
# NOTE:		Actually calls several other effects that set the variables

TRADE_update_governorship_TZs = {
	if = {
		limit = { NOT = { has_variable = trade_center } }
		capital_scope = {
			if = {
				limit = { india_tradezone = { PROVINCE = yes } }
				random_trade_center = {
					limit = { india_tradezone = { PROVINCE = yes } }
					save_scope_as = trade_center_province
				}
			}
			else_if = {
				limit = { east_north_america_tradezone = { PROVINCE = yes } }
				random_trade_center = {
					limit = { east_north_america_tradezone = { PROVINCE = yes } }
					save_scope_as = trade_center_province
				}
			}
			else_if = {
				limit = { west_north_america_tradezone = { PROVINCE = yes } }
				random_trade_center = {
					limit = { west_north_america_tradezone = { PROVINCE = yes } }
					save_scope_as = trade_center_province
				}
			}
			else_if = {
				limit = { caribbean_tradezone = { PROVINCE = yes } }
				random_trade_center = {
					limit = { caribbean_tradezone = { PROVINCE = yes } }
					save_scope_as = trade_center_province
				}
			}
			else_if = {
				limit = { west_south_america_tradezone = { PROVINCE = yes } }
				random_trade_center = {
					limit = { west_south_america_tradezone = { PROVINCE = yes } }
					save_scope_as = trade_center_province
				}
			}
			else_if = {
				limit = { east_south_america_tradezone = { PROVINCE = yes } }
				random_trade_center = {
					limit = { east_south_america_tradezone = { PROVINCE = yes } }
					save_scope_as = trade_center_province
				}
			}
			else_if = {
				limit = { south_east_asia_tradezone = { PROVINCE = yes } }
				random_trade_center = {
					limit = { south_east_asia_tradezone = { PROVINCE = yes } }
					save_scope_as = trade_center_province
				}
			}
			else_if = {
				limit = { indo_china_tradezone = { PROVINCE = yes } }
				random_trade_center = {
					limit = { indo_china_tradezone = { PROVINCE = yes } }
					save_scope_as = trade_center_province
				}
			}
			else_if = {
				limit = { yellow_sea_tradezone = { PROVINCE = yes } }
				random_trade_center = {
					limit = { yellow_sea_tradezone = { PROVINCE = yes } }
					save_scope_as = trade_center_province
				}
			}
			else_if = {
				limit = { southern_africa_tradezone = { PROVINCE = yes } }
				random_trade_center = {
					limit = { southern_africa_tradezone = { PROVINCE = yes } }
					save_scope_as = trade_center_province
				}
			}
			else_if = {
				limit = { west_africa_tradezone = { PROVINCE = yes } }
				random_trade_center = {
					limit = { west_africa_tradezone = { PROVINCE = yes } }
					save_scope_as = trade_center_province
				}
			}
			else_if = {
				limit = { east_africa_tradezone = { PROVINCE = yes } }
				random_trade_center = {
					limit = { east_africa_tradezone = { PROVINCE = yes } }
					save_scope_as = trade_center_province
				}
			}
			else_if = {
				limit = { middle_east_tradezone = { PROVINCE = yes } }
				random_trade_center = {
					limit = { middle_east_tradezone = { PROVINCE = yes } }
					save_scope_as = trade_center_province
				}
			}
			else_if = {
				limit = { western_steppe_tradezone = { PROVINCE = yes } }
				random_trade_center = {
					limit = { western_steppe_tradezone = { PROVINCE = yes } }
					save_scope_as = trade_center_province
				}
			}
			else_if = {
				limit = { eastern_steppe_tradezone = { PROVINCE = yes } }
				random_trade_center = {
					limit = { eastern_steppe_tradezone = { PROVINCE = yes } }
					save_scope_as = trade_center_province
				}
			}
			else_if = {
				limit = { upper_yangtzi_tradezone = { PROVINCE = yes } }
				random_trade_center = {
					limit = { upper_yangtzi_tradezone = { PROVINCE = yes } }
					save_scope_as = trade_center_province
				}
			}
			else_if = {
				limit = { atlantic_seaboard_tradezone = { PROVINCE = yes } }
				random_trade_center = {
					limit = { atlantic_seaboard_tradezone = { PROVINCE = yes } }
					save_scope_as = trade_center_province
				}
			}
			else_if = {
				limit = { central_europe_tradezone = { PROVINCE = yes } }
				random_trade_center = {
					limit = { central_europe_tradezone = { PROVINCE = yes } }
					save_scope_as = trade_center_province
				}
			}
			else_if = {
				limit = { west_mediterranean_tradezone = { PROVINCE = yes } }
				random_trade_center = {
					limit = { west_mediterranean_tradezone = { PROVINCE = yes } }
					save_scope_as = trade_center_province
				}
			}
			else_if = {
				limit = { baltic_tradezone = { PROVINCE = yes } }
				random_trade_center = {
					limit = { baltic_tradezone = { PROVINCE = yes } }
					save_scope_as = trade_center_province
				}
			}
			else_if = {
				limit = { east_europe_tradezone = { PROVINCE = yes } }
				random_trade_center = {
					limit = { east_europe_tradezone = { PROVINCE = yes } }
					save_scope_as = trade_center_province
				}
			}
			else_if = {
				limit = { east_mediterranean_tradezone = { PROVINCE = yes } }
				random_trade_center = {
					limit = { east_mediterranean_tradezone = { PROVINCE = yes } }
					save_scope_as = trade_center_province
				}
			}
		}
		set_variable = { # Save it in the governorship
			name = trade_center
			value = scope:trade_center_province
		}
	}  
}

# Function:	Set a province as the "trade center" scope for a tradezone (TZ) to act as a scope for that TZ.
# Scope:	any
# Called:	1) At the beginning of the game

TRADE_setup_tradezones = { # Calls the tradezone_setup_effect for every tradezone
	#Populate the world with trade centers - 1 per tradezone.
	set_global_variable = economic_enhancement_setup_done
	tradezone_setup_effect = {
		 TRADE_ZONE = india_tradezone
	}
	tradezone_setup_effect = {
		 TRADE_ZONE = east_north_america_tradezone
	}
	tradezone_setup_effect = {
		 TRADE_ZONE = west_north_america_tradezone
	}
	tradezone_setup_effect = {
		 TRADE_ZONE = caribbean_tradezone
	}
	tradezone_setup_effect = {
		 TRADE_ZONE = west_south_america_tradezone
	}
	tradezone_setup_effect = {
		 TRADE_ZONE = east_south_america_tradezone
	}
	tradezone_setup_effect = {
		 TRADE_ZONE = south_east_asia_tradezone
	}
	tradezone_setup_effect = {
		 TRADE_ZONE = indo_china_tradezone
	}
	tradezone_setup_effect = {
		 TRADE_ZONE = yellow_sea_tradezone
	}
	tradezone_setup_effect = {
		 TRADE_ZONE = southern_africa_tradezone
	}
	tradezone_setup_effect = {
		 TRADE_ZONE = west_africa_tradezone
	}
	tradezone_setup_effect = {
		 TRADE_ZONE = east_africa_tradezone
	}
	tradezone_setup_effect = {
		 TRADE_ZONE = middle_east_tradezone
	}
	tradezone_setup_effect = {
		 TRADE_ZONE = western_steppe_tradezone
	}
	tradezone_setup_effect = {
		 TRADE_ZONE = eastern_steppe_tradezone
	}
	tradezone_setup_effect = {
		 TRADE_ZONE = upper_yangtzi_tradezone
	}
	tradezone_setup_effect = {
		 TRADE_ZONE = atlantic_seaboard_tradezone
	}
	tradezone_setup_effect = {
		 TRADE_ZONE = central_europe_tradezone
	}
	tradezone_setup_effect = {
		 TRADE_ZONE = west_mediterranean_tradezone
	}
	tradezone_setup_effect = {
		 TRADE_ZONE = baltic_tradezone
	}
	tradezone_setup_effect = {
		 TRADE_ZONE = east_europe_tradezone
	}
	tradezone_setup_effect = {
		 TRADE_ZONE = east_mediterranean_tradezone
	}
}

# Function:	Get every governorship in a specified trade zone, only used to put goverorship svalues into trade zone svalues
# Scope:	Country

stockpile_every_governorship_in_tradezone = {
	every_governorships = {
		random_governorship_state = {
			limit = {
				 any_state_province = {
					$TRADE_ZONE$ = { PROVINCE = yes }
				}
			}
			random_state_province = {
				$TRADE_ZONE$ = { PROVINCE = yes }
			}
		}
		add = $STOCKPILE$
	}
}

# Function:	Store all the necessary values as variables every quarter
# Scope:	Governorship
# Called:	1) Every quarter before doing trade
#			2) At the beginning of the game, to prevent any errors from missing variables referenced in svalues
# NOTE:		Actually calls several other effects that set the variables
TRADE_governorship_set_variables = {
	TRADE_governorships_get_pops_this_quarter = yes
}

# Function:	Store population values for a governorship in variables so that they can be referenced multiple times quickly in one quarter, rather than being re-calculated every time as a svalue
# Scope:	Governorship
# Called:	1) Every quarter before doing trade
#			2) At the beginning of the game, to prevent any errors from missing variables referenced in svalues
# NOTE:		Whenever this is called, the variables are overwritten.

TRADE_governorship_get_pops_this_quarter = {
	set_variable = {
		name = gov_total_pop_this_quarter
		value = governorship_population
	}
	set_variable = {
		name = gov_upper_strata_this_quarter
		value = governorship_upper_strata
	}
	set_variable = {
		name = gov_middle_strata_this_quarter
		value = governorship_middle_strata
	}
	set_variable = {
		name = gov_lower_strata_this_quarter
		value = governorship_lower_strata
	}
	set_variable = {
		name = gov_indentured_this_quarter
		value = governorship_indentured
	}
	set_variable = {
		name = gov_tribesmen_this_quarter
		value = governorship_tribesmen
	}
	set_variable = {
		name = gov_slaves_this_quarter
		value = governorship_slaves
	}
}

# Effects supporting the PURCHASE and SELL effects

TRADE_set_internal_trade_scope = {
	# Function: Tell the governorship whether it's selling to a country or a customs union when doing internal trade
	# Scope: governorship
	# Called: Every quarter before doing trade
	if = {
		limit = {
			NOT = { has_variable = federation_customs_union }
		}
		set_variable = {
			name = internal_trade_scope
			value = capital_scope.owner
		}
	}
	else = {
		set_variable = {
			name = internal_trade_scope
			value = var:federation_customs_union
		}
	}
}

TRADE_set_trade_capacity = {
	# Function: Set a variable derived from the infrastructure in a governorship that informs the system how much a governorship can import and export
	# See TRADE_svalues: TRADE_governorship_infrastructure_capacity_svalue
	# Scope: governorship
	# Called: NOT AT THE MOMENT, BUILDING SETUP NEEDS TO BE REFINED
	# TODO: Factor this in as a max value in all declare availables and purchase orders
	set_variable = {
		name = governorship_trade_capacity
		value = TRADE_governorship_infrastructure_capacity_svalue
	}
}

TRADE_reset_quarterly_governorship_values = {
	# Scope: governorship
	set_variable = {
		name = governorship_this_quarter_income_from_essentials
		value = 0
	}
	set_variable = {
		name = governorship_this_quarter_income_from_luxuries
		value = 0
	}
	set_variable = {
		name = governorship_this_quarter_income_from_business_goods
		value = 0
	}
	set_variable = {
		name = governorship_this_quarter_income_from_military
		value = 0
	}
	set_variable = {
		name = governorship_this_quarter_spend_on_luxuries
		value = 0
	}
	set_variable = {
		name = governorship_this_quarter_spend_on_business_goods
		value = 0
	}
	set_variable = {
		name = governorship_this_quarter_spend_on_essentials
		value = 0
	}
	set_variable = {
		name = governorship_this_quarter_spend_on_military
		value = 0
	}
	PURCHASE_reset_quarterly_var = yes
	SELL_reset_all_internal_amounts_offered = yes
}

TRADE_set_spender_shares = {
	# Scope: governorship
	# Function: Get all the split of costs between pop groups and the state into variables so they don't have to be re-calculated every time they're called.
	# These come already as percentages
	TRADE_set_spender_share = {
		category = essentials
	}
	TRADE_set_spender_share = {
		category = luxuries
	}
	TRADE_set_spender_share = {
		category = business_goods
	}
	TRADE_set_spender_share = {
		category = military
	}
	
}

TRADE_set_spender_share = {
	# Scope: governorship
	set_variable = {
		name = spender_share_$category$_upper_strata
		value = TRADE_spender_share_percentage_essentials_upper_strata
	}
	set_variable = {
		name = spender_share_$category$_middle_strata
		value = TRADE_spender_share_percentage_essentials_middle_strata
	}
	set_variable = {
		name = spender_share_$category$_lower_strata
		value = TRADE_spender_share_percentage_essentials_lower_strata
	}
	set_variable = {
		name = spender_share_$category$_proletariat
		value = TRADE_spender_share_percentage_essentials_proletariat
	}
	set_variable = {
		name = spender_share_$category$_indentured
		value = TRADE_spender_share_percentage_essentials_indentured
	}
	set_variable = {
		name = spender_share_$category$_tribesmen
		value = TRADE_spender_share_percentage_essentials_tribesmen
	}
	set_variable = {
		name = spender_share_$category$_slaves
		value = TRADE_spender_share_percentage_essentials_slaves
	}
	set_variable = {
		name = spender_share_$category$_the_state
		value = TRADE_spender_share_percentage_essentials_the_state
	}
}

TRADE_set_income_shares = {
	# Scope: governorship
	# Function: Get all the split of costs between pop groups and the state into variables so they don't have to be re-calculated every time they're called.
	# These come already as percentages
	TRADE_set_income_share = {
		category = essentials
	}
	TRADE_set_income_share = {
		category = luxuries
	}
	TRADE_set_income_share = {
		category = business_goods
	}
	TRADE_set_income_share = {
		category = military
	}
	
}

TRADE_set_income_share = {
	# Scope: governorship
	set_variable = {
		name = income_share_$category$_upper_strata
		value = TRADE_income_share_percentage_essentials_upper_strata
	}
	set_variable = {
		name = income_share_$category$_middle_strata
		value = TRADE_income_share_percentage_essentials_middle_strata
	}
	set_variable = {
		name = income_share_$category$_lower_strata
		value = TRADE_income_share_percentage_essentials_lower_strata
	}
	set_variable = {
		name = income_share_$category$_proletariat
		value = TRADE_income_share_percentage_essentials_proletariat
	}
	set_variable = {
		name = income_share_$category$_indentured
		value = TRADE_income_share_percentage_essentials_indentured
	}
	set_variable = {
		name = income_share_$category$_tribesmen
		value = TRADE_income_share_percentage_essentials_tribesmen
	}
	set_variable = {
		name = income_share_$category$_slaves
		value = TRADE_income_share_percentage_essentials_slaves
	}
	set_variable = {
		name = income_share_$category$_the_state
		value = TRADE_income_share_percentage_essentials_the_state
	}
}

TRADE_reset_quarterly_trade_scope_values = {
	# Scope: random country
	TRADE_reset_internal_pools = yes
	SELL_reset_all_internal_trade_stockpiles = yes
}

TRADE_reset_internal_pools = {
	every_country = {
		set_variable = {
			name = internal_income_pool
			value = 0
		}
	}
	every_federation = {
		set_variable = {
			name = internal_income_pool
			value = 0
		}
	}
	TRADE_reset_internal_amounts_sold = yes
}

TRADE_reset_internal_amounts_sold = {
	# Scope: random country

	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = grain }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = grain }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = fish }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = fish }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = livestock }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = livestock }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = tropical_fruit }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = tropical_fruit }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = mediterranean_fruit }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = mediterranean_fruit }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = temperate_fruit }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = temperate_fruit }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = processed_foods }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = processed_foods }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = clothing }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = clothing }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = furniture }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = furniture }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = pharmaceuticals }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = pharmaceuticals }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = coal }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = coal }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = whales }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = whales }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = alcohol }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = alcohol }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = gems }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = gems }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = opium }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = opium }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = tobacco }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = tobacco }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = chocolate }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = chocolate }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = coffee }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = coffee }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = tea }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = tea }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = spices }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = spices }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = sugar }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = sugar }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = luxury_clothing }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = luxury_clothing }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = luxury_furniture }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = luxury_furniture }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = glass }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = glass }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = motors }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = motors }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = fur }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = fur }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = industrial_fibres }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = industrial_fibres }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = textile_fibres }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = textile_fibres }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = wool }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = wool }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = silk }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = silk }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = wood }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = wood }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = stone }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = stone }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = sulphur }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = sulphur }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = peat }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = peat }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = tin }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = tin }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = inorganic_compounds }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = inorganic_compounds }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = copper }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = copper }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = iron }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = iron }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = gold }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = gold }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = silver }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = silver }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = dye }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = dye }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = lead }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = lead }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = oil }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = oil }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = hardwood }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = hardwood }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = rubber }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = rubber }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = salt }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = salt }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = electronics }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = electronics }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = construction_materials }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = construction_materials }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = steel }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = steel }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = bronze }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = bronze }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = machine_parts }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = machine_parts }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = chemicals }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = chemicals }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = naval_supplies }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = naval_supplies }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = steel_ships }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = steel_ships }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = wooden_ships }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = wooden_ships }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = petrochemicals }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = petrochemicals }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = early_munitions }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = early_munitions }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = late_munitions }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = late_munitions }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = early_artillery }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = early_artillery }
	}
	every_country = {
		TRADE_reset_internal_amount_sold = { tradegood = late_artillery }
	}
	every_federation = {
		TRADE_reset_internal_amount_sold = { tradegood = late_artillery }
	}
}

TRADE_reset_internal_amount_sold = {
	# Scope: internal trade scope

	# Format of arguments:
	# $internal_sold_total$ = internal_sold_total_grain
	set_variable = {
		name = internal_sold_total_$tradegood$
		value = 0
	}
}

TRADE_reset_all_internal_trade_stockpiles = {
	# Scope: Random country
	# Called: Quarterly
	# Resets all internal trade stockpiles to 0
	#WiP: grain only
	every_country = {
		set_variable = {
			name = grain_stockpile_internal
			value = 0 
		}
	}
	every_federation = {
		set_variable = {
			name = grain_stockpile_internal
			value = 0
		}
	}
}

TRADE_reset_all_internal_trade_revenue_totals = {
	# Scope: Random country
	# Called: Quarterly
	# Resets all internal trade stockpiles to 0
	#WiP: grain only
	every_country = {
		set_variable = {
			name = internal_total_revenue_grain
			value = 0 
		}
	}
	every_federation = {
		set_variable = {
			name = internal_total_revenue_grain
			value = 0 
		}
	}
}

TRADE_update_all_global_base_prices = {
	TRADE_update_global_base_price = {
		tradegood = grain
	}
	TRADE_update_global_base_price = {
		tradegood = fur
	}
	TRADE_update_global_base_price = {
		tradegood = industrial_fibres
	}
	TRADE_update_global_base_price = {
		tradegood = textile_fibres
	}
	TRADE_update_global_base_price = {
		tradegood = wool
	}
	TRADE_update_global_base_price = {
		tradegood = silk
	}
	TRADE_update_global_base_price = {
		tradegood = wood
	}
	TRADE_update_global_base_price = {
		tradegood = stone
	}
	TRADE_update_global_base_price = {
		tradegood = sulphur
	}
	TRADE_update_global_base_price = {
		tradegood = whales
	}
	TRADE_update_global_base_price = {
		tradegood = gems
	}
	TRADE_update_global_base_price = {
		tradegood = peat
	}
	TRADE_update_global_base_price = {
		tradegood = tin
	}
	TRADE_update_global_base_price = {
		tradegood = inorganic_compounds
	}
	TRADE_update_global_base_price = {
		tradegood = copper
	}
	TRADE_update_global_base_price = {
		tradegood = iron
	}
	TRADE_update_global_base_price = {
		tradegood = gold
	}
	TRADE_update_global_base_price = {
		tradegood = silver
	}
	TRADE_update_global_base_price = {
		tradegood = lead
	}
	TRADE_update_global_base_price = {
		tradegood = coal
	}
	TRADE_update_global_base_price = {
		tradegood = oil
	}
	TRADE_update_global_base_price = {
		tradegood = tea
	}
	TRADE_update_global_base_price = {
		tradegood = coffee
	}
	TRADE_update_global_base_price = {
		tradegood = opium
	}
	TRADE_update_global_base_price = {
		tradegood = tobacco
	}
	TRADE_update_global_base_price = {
		tradegood = sugar
	}
	TRADE_update_global_base_price = {
		tradegood = hardwood
	}
	TRADE_update_global_base_price = {
		tradegood = rubber
	}
	TRADE_update_global_base_price = {
		tradegood = dye
	}
	TRADE_update_global_base_price = {
		tradegood = spices
	}
	TRADE_update_global_base_price = {
		tradegood = temperate_fruit
	}
	TRADE_update_global_base_price = {
		tradegood = tropical_fruit
	}
	TRADE_update_global_base_price = {
		tradegood = mediterranean_fruit
	}
	TRADE_update_global_base_price = {
		tradegood = chocolate
	}
	TRADE_update_global_base_price = {
		tradegood = livestock
	}
	TRADE_update_global_base_price = {
		tradegood = salt
	}
	TRADE_update_global_base_price = {
		tradegood = fish
	}
	TRADE_update_global_base_price = {
		tradegood = clothing
	}
	TRADE_update_global_base_price = {
		tradegood = luxury_clothing
	}
	TRADE_update_global_base_price = {
		tradegood = furniture
	}
	TRADE_update_global_base_price = {
		tradegood = luxury_furniture
	}
	TRADE_update_global_base_price = {
		tradegood = alcohol
	}
	TRADE_update_global_base_price = {
		tradegood = glass
	}
	TRADE_update_global_base_price = {
		tradegood = chemicals
	}
	TRADE_update_global_base_price = {
		tradegood = rare_alloys
	}
	TRADE_update_global_base_price = {
		tradegood = construction_materials
	}
	TRADE_update_global_base_price = {
		tradegood = early_munitions
	}
	TRADE_update_global_base_price = {
		tradegood = late_munitions
	}
	TRADE_update_global_base_price = {
		tradegood = naval_supplies
	}
	TRADE_update_global_base_price = {
		tradegood = steel_ships
	}
	TRADE_update_global_base_price = {
		tradegood = wooden_ships
	}
	TRADE_update_global_base_price = {
		tradegood = steel
	}
	TRADE_update_global_base_price = {
		tradegood = bronze
	}
	TRADE_update_global_base_price = {
		tradegood = machine_parts
	}
	TRADE_update_global_base_price = {
		tradegood = early_artillery
	}
	TRADE_update_global_base_price = {
		tradegood = late_artillery
	}
	TRADE_update_global_base_price = {
		tradegood = electronics
	}
	TRADE_update_global_base_price = {
		tradegood = pharmaceuticals
	}
	TRADE_update_global_base_price = {
		tradegood = motors
	}
	TRADE_update_global_base_price = {
		tradegood = processed_foods
	}
	TRADE_update_global_base_price = {
		tradegood = petrochemicals
	}
}

TRADE_update_global_base_price = {
	# Scope: Random country, doesn't matter
	# This effect sets the global base price for a tradegood
	# The formula is:
	# Base price = global units demanded / units produced # For now, anyway
	# This checks the given good

	# Format of arguments:
	# $global_price$ = global_price_grain
	# $global_supply$ = global_supply_grain
	# $global_demand$ = global_demand_grain
	# $demand_good$ = DEMAND_grain, svalue, see DEMAND_svalues
	# $supply_good$ = GOODS_governorship_grain_produced, svalue, see GOODS_svalues

	set_global_variable = {
		name = global_demand_$tradegood$
		value = 1 # Starts 1, gets augmented
	}

	set_global_variable = {
		name = global_supply_$tradegood$
		value = 1 # Starts 1, gets augmented
	}

	# Add the total of all demand for this good around the world
	every_country = {
		every_governorships = {
			change_global_variable = {
				name = global_demand_$tradegood$
				add = DEMAND_$tradegood$
			}
			change_global_variable = {
				name = global_supply_$tradegood$
				add = GOODS_governorship_$tradegood$_produced
			}
		}
	}
	# NOTE: Global supply should probably be the amount offered in all TZs, not produced in every governorship
	# See TRADE_svalues TRADE_global_offered_grain for WiP example

	# Now calculate the price
	set_global_variable = {
		name = global_price_$tradegood$
		value = global_var:global_demand_$tradegood$
	}
	change_global_variable = {
		name = global_price_$tradegood$
		divide = global_var:global_supply_$tradegood$
	}

	change_global_variable = {
		name = global_price_$tradegood$
		multiply = 0.01
	}

}

TRADE_update_all_TZ_local_prices = {
	every_in_global_list = {
		variable = list_of_trade_centers
		limit = { always = yes } # Debug purposes only, this should contain an actual limit checking if the TZ actually has any stock of the named tradegood
		SELL_set_TZ_prices = {
			tradegood = grain
		}
		SELL_set_TZ_prices = {
			tradegood = fur
		}
		SELL_set_TZ_prices = {
			tradegood = industrial_fibres
		}
		SELL_set_TZ_prices = {
			tradegood = textile_fibres
		}
		SELL_set_TZ_prices = {
			tradegood = wool
		}
		SELL_set_TZ_prices = {
			tradegood = silk
		}
		SELL_set_TZ_prices = {
			tradegood = wood
		}
		SELL_set_TZ_prices = {
			tradegood = stone
		}
		SELL_set_TZ_prices = {
			tradegood = sulphur
		}
		SELL_set_TZ_prices = {
			tradegood = whales
		}
		SELL_set_TZ_prices = {
			tradegood = gems
		}
		SELL_set_TZ_prices = {
			tradegood = peat
		}
		SELL_set_TZ_prices = {
			tradegood = tin
		}
		SELL_set_TZ_prices = {
			tradegood = inorganic_compounds
		}
		SELL_set_TZ_prices = {
			tradegood = copper
		}
		SELL_set_TZ_prices = {
			tradegood = iron
		}
		SELL_set_TZ_prices = {
			tradegood = gold
		}
		SELL_set_TZ_prices = {
			tradegood = silver
		}
		SELL_set_TZ_prices = {
			tradegood = lead
		}
		SELL_set_TZ_prices = {
			tradegood = coal
		}
		SELL_set_TZ_prices = {
			tradegood = oil
		}
		SELL_set_TZ_prices = {
			tradegood = tea
		}
		SELL_set_TZ_prices = {
			tradegood = coffee
		}
		SELL_set_TZ_prices = {
			tradegood = opium
		}
		SELL_set_TZ_prices = {
			tradegood = tobacco
		}
		SELL_set_TZ_prices = {
			tradegood = sugar
		}
		SELL_set_TZ_prices = {
			tradegood = hardwood
		}
		SELL_set_TZ_prices = {
			tradegood = rubber
		}
		SELL_set_TZ_prices = {
			tradegood = dye
		}
		SELL_set_TZ_prices = {
			tradegood = spices
		}
		SELL_set_TZ_prices = {
			tradegood = temperate_fruit
		}
		SELL_set_TZ_prices = {
			tradegood = tropical_fruit
		}
		SELL_set_TZ_prices = {
			tradegood = mediterranean_fruit
		}
		SELL_set_TZ_prices = {
			tradegood = chocolate
		}
		SELL_set_TZ_prices = {
			tradegood = livestock
		}
		SELL_set_TZ_prices = {
			tradegood = salt
		}
		SELL_set_TZ_prices = {
			tradegood = fish
		}
		SELL_set_TZ_prices = {
			tradegood = clothing
		}
		SELL_set_TZ_prices = {
			tradegood = luxury_clothing
		}
		SELL_set_TZ_prices = {
			tradegood = furniture
		}
		SELL_set_TZ_prices = {
			tradegood = luxury_furniture
		}
		SELL_set_TZ_prices = {
			tradegood = alcohol
		}
		SELL_set_TZ_prices = {
			tradegood = glass
		}
		SELL_set_TZ_prices = {
			tradegood = chemicals
		}
		SELL_set_TZ_prices = {
			tradegood = rare_alloys
		}
		SELL_set_TZ_prices = {
			tradegood = construction_materials
		}
		SELL_set_TZ_prices = {
			tradegood = early_munitions
		}
		SELL_set_TZ_prices = {
			tradegood = late_munitions
		}
		SELL_set_TZ_prices = {
			tradegood = naval_supplies
		}
		SELL_set_TZ_prices = {
			tradegood = steel_ships
		}
		SELL_set_TZ_prices = {
			tradegood = wooden_ships
		}
		SELL_set_TZ_prices = {
			tradegood = steel
		}
		SELL_set_TZ_prices = {
			tradegood = bronze
		}
		SELL_set_TZ_prices = {
			tradegood = machine_parts
		}
		SELL_set_TZ_prices = {
			tradegood = early_artillery
		}
		SELL_set_TZ_prices = {
			tradegood = late_artillery
		}
		SELL_set_TZ_prices = {
			tradegood = electronics
		}
		SELL_set_TZ_prices = {
			tradegood = pharmaceuticals
		}
		SELL_set_TZ_prices = {
			tradegood = motors
		}
		SELL_set_TZ_prices = {
			tradegood = processed_foods
		}
		SELL_set_TZ_prices = {
			tradegood = petrochemicals
		}
	}
}

TRADE_set_all_local_internal_cuts_of_revenue = {
	# Scope: governorship
	# Called: start of game
	# Sets all local internal cuts of revenue for this quarter to 0
	# Needs to exist because the trade effects cannot set variables that don't exist yet
	set_variable = { # Grain
		name = local_internal_revenue_cut_grain
		value = 0
	}
}

TRADE_set_all_internal_stockpile_cut_percentages = {
	# Scope: governorship
	# Called: start of game
	# Sets all local internal revenue cut percentages for this quarter to 0
	# Needs to exist because the trade effects cannot set variables that don't exist yet
	set_variable = { # Grain
		name = internal_stockpile_cut_percentage_grain
		value = 0
	}
}

TRADE_setup_internal_trade_cuts = {
	TRADE_set_all_local_internal_cuts_of_revenue = yes
	TRADE_set_all_internal_stockpile_cut_percentages =yes
}