namespace = send_settlers

send_settlers.1 = {

	# Send settlers to occupy an area, can result in the adding of pops
	type = country_event
	title = send_settlers.1.t
	desc = send_settlers.1.desc

    left_portrait = scope:foreign_minister

    picture = naval_bay # TODO: Pick a better picture

    goto_location = scope:diplomatic_play.var:play_target_area

    trigger = {
    	any_owned_province = {
    		any_neighbor_province = {
    			owner = scope:diplomatic_play.var:play_target_country
                area = scope:diplomatic_play.var:play_target_area.area
    		}
    	}
    }

    immediate = {
        # Select an origin province in a neighbouring governorship
        random_owned_province = {
            limit = {
                governorship = {
                    any_governorship_state = {
                        any_state_province = {
                            any_neighbor_province = {
                                owner = scope:diplomatic_play.var:play_target_country
                            }
                        }
                    }
                }
                total_population > 1
                any_pops_in_province = {
                    culture.culture_group = scope:diplomatic_play.var:play_instigator.culture.culture_group # TODO: Test that this trigger works directly in explorer
                }
            }
            save_scope_as = emigration_point
        }

        # Select the destination in the play target area
        scope:diplomatic_play.var:play_target_country = {
            random_owned_province = {
                limit = {
                    area = scope:diplomatic_play.var:play_target_area.area
                }
                save_scope_as = immigration_point
            }
        }
    }

    option = { # Allow settlers to go
    	# Moderate success chance
    	# Major progress
    	# Trigger event for target, move pops from instigator to target area
        name = send_settlers.1.a
        custom_tooltip = diplomatic_play.1.a.tt
        ai_chance = {
            modifier = {
                factor = 30
                opinion = {
                    target = scope:diplomatic_play.var:play_target_country
                    value < 0
                }
            }
            modifier = {
                factor = 30
                DIPLOMACY_play_attitude_friendly_trigger = no
            }
            modifier = {
                factor = 30
                DIPLOMACY_play_attitude_hostile_trigger = yes
            }
            modifier = {
                factor = 30
                DIPLOMACY_play_war_not_willing_trigger = yes
            }
        }

        scope:emigration_point = {
            random_pops_in_province = {
                limit = {
                    culture.culture_group = scope:diplomatic_play.var:play_instigator.culture.culture_group
                }
                move_pop = scope:immigration_point
            }
        }
        add_opinion = {
            modifier = hindered_in_play
            target = scope:diplomatic_play.var:play_target_country
        }
    }

    option = { # Forbid and arrest settlers
    	# Negligible stability loss
    	# No progress
        name = send_settlers.1.b
        custom_tooltip = diplomatic_play.1.b.tt
        ai_chance = {
            modifier = {
                factor = 20
                opinion = {
                    target = scope:diplomatic_play.var:play_target_country
                    value > 0
                }
            }
            modifier = {
                factor = 30
                DIPLOMACY_play_attitude_friendly_trigger = yes
            }
            modifier = {
                factor = 30
                DIPLOMACY_play_war_willing_trigger = no
            }
        } 
        add_stability = -1
        add_tyranny = 1 
    }

}