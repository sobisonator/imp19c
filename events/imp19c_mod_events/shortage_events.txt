namespace = shortage

shortage.1 = { # General food shortage
	type = country_event
	hidden = no

	left_portrait = scope:famine_province.governorship.governor

	goto_location = scope:famine_province

	trigger = {
		any_governorships = {
			ECON_governorship_food_shortage > 0.3
		}
	}

	immediate = {
		random_governorships = {
			limit = {
				ECON_governorship_food_shortage > 0.3
			}
			random_governorship_state = {
				limit = {
					any_state_province = {
						total_population > 1
					}
				}
				random_state_province = {
					save_scope_as = famine_province
					limit = {
						total_population > 1
						NOT = {
							has_province_modifier = recent_famine
						}
					}
					add_province_modifier = {
						name = recent_famine
						duration = 1095
					}
					random_pops_in_province = {
						weight = {
							modifier = {
								factor = 100
								NOT = {
									pop_type = upper_strata
								}
							}
							modifier = {
								factor = 75
								NOT = {
									pop_type = middle_strata
								}
							}
						}
						kill_pop = yes
					}
				}
			}
			change_variable = {
				name = upper_strata_wealth
				subtract = {
					value = WEALTH_governorship_per_capita
					divide = 7
				}
			}
			change_variable = {
				name = middle_strata_wealth
				subtract = {
					value = WEALTH_governorship_per_capita
					divide = 7
				}
			}
			change_variable = {
				name = lower_strata_wealth
				subtract = {
					value = WEALTH_governorship_per_capita
					divide = 7
				}
			}
			change_variable = {
				name = proletariat_wealth
				subtract = {
					value = WEALTH_governorship_per_capita
					divide = 7
				}
			}
			change_variable = {
				name = tribesmen_wealth
				subtract = {
					value = WEALTH_governorship_per_capita
					divide = 7
				}
			}
		}
	}

	option = {
		name = "shortage.1.a"
		add_treasury = {
			value = 10 # TODO: Cost of food
		}
	}

	option = {
		name = "shortage.1.b"
		scope:famine_province = {
			add_province_modifier = {
				name = recent_famine_ignored
				duration = 1095
			}
		}
	}

}